#!/usr/bin/env ruby

require 'ddreleaser'
require 'yaml'

pipeline_yaml = YAML.load_file(ARGV[0])

stages = []
pipeline_yaml['stages'].each do |stage_yaml|
  goals = []
  stage_yaml['goals'].each do |goal_yaml|
    name = goal_yaml.keys.first
    # TODO: what if there are more?

    goal_class = DDReleaser::Goal.named(name.to_sym)
    goal = goal_class.from_yaml(goal_yaml)

    goals << goal
  end

  stages << DDReleaser::Stage.new(stage_yaml['name'], goals)
end

DDReleaser::Runner.new(stages).run
